<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head :: head(#{admin.crops.title})}"></head>
<body>
<nav th:replace="~{fragments/nav :: nav}"></nav>
<div class="container mt-4">
  <h1 class="mb-4" th:text="#{admin.crops.title}">Cultivos</h1>
  <form id="admin-crop-form" class="api mb-4" method="post" action="">
    <div class="row g-3">
      <div class="col-md-4">
        <label class="form-label">Usuario</label>
        <select id="user-select" class="form-select" name="userId"></select>
      </div>
      <div class="col-md-4">
        <label class="form-label">Alias</label>
        <input type="text" name="alias" class="form-control" required>
      </div>
      <div class="col-md-4">
        <label class="form-label">Ubicación</label>
        <input type="text" name="location" class="form-control" required>
      </div>
      <div class="col-md-4">
        <label class="form-label">Latitud</label>
        <input type="number" step="0.0001" name="latitud" class="form-control" required>
      </div>
      <div class="col-md-4">
        <label class="form-label">Longitud</label>
        <input type="number" step="0.0001" name="longitud" class="form-control" required>
      </div>
      <div class="col-12">
        <div id="map" style="height: 300px" class="mb-3"></div>
      </div>
      <div class="col-md-4">
        <label class="form-label">Flor</label>
        <input type="text" name="flowerName" class="form-control" required>
      </div>
      <div class="col-md-4">
        <label class="form-label">Area</label>
        <input type="number" name="area" class="form-control" required>
      </div>
      <div class="col-md-4">
        <label class="form-label">Plantas</label>
        <input type="number" name="numberPlants" class="form-control" required>
      </div>
    </div>
    <button type="submit" class="btn btn-success mt-3" th:text="#{create.button}">Crear</button>
  </form>
  <p><a th:href="@{/admin}" th:text="#{admin.menu.back}">Volver a administración</a></p>
  <p><a th:href="@{/}" th:text="#{link.home}">Volver al inicio</a></p>
</div>
<div th:replace="~{fragments/scripts :: scripts}"></div>
<script th:inline="javascript">
$(function(){
    async function loadUsers(){
        const res = await fetch('/api/admin/users');
        if(!res.ok) return;
        const data = await res.json();
        const $sel = $('#user-select');
        data.forEach(u => $sel.append(`<option value="${u.id}">${u.name}</option>`));
        updateAction();
    }
    function updateAction(){
        const id = $('#user-select').val();
        $('#admin-crop-form').attr('action', `/api/admin/users/${id}/crops`);
    }
    $('#user-select').on('change', updateAction);
    loadUsers();
});
</script>
</body>
</html>
